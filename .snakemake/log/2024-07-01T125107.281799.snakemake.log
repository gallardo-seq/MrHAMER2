Building DAG of jobs...
Using shell: /bin/bash
Provided cores: 32
Rules claiming more threads will be scaled down.
Job stats:
job                            count
---------------------------  -------
chimera_buster                     1
cluster                            1
cluster_consensus                  1
copy_bed                           1
detect_umi_consensus_fasta         1
detect_umi_fasta                   1
map_1d                             1
map_consensus                      2
mv_CB_file                         1
polish_clusters                    1
pull_nonchimeras                   1
reads                              1
reformat_consensus_clusters        1
reformat_filter_clusters           1
seqkit_bam_acc_tsv                 1
split_reads                        1
total                             17

Select jobs to execute...

[Mon Jul  1 12:51:07 2024]
rule copy_bed:
    input: test_files/regions.bed
    output: MrHAMER2_test/targets.bed
    jobid: 1
    reason: Missing output files: MrHAMER2_test/targets.bed
    wildcards: name=MrHAMER2_test
    resources: tmpdir=/tmp


[Mon Jul  1 12:51:07 2024]
rule map_1d:
    input: test_files/MrHAMER2_test.fastq, test_files/NL43_Complete.fa
    output: MrHAMER2_test/align/1d.bam, MrHAMER2_test/align/1d.bam.bai
    jobid: 11
    reason: Missing output files: MrHAMER2_test/align/1d.bam
    wildcards: name=MrHAMER2_test
    threads: 30
    resources: tmpdir=/tmp

[Mon Jul  1 12:51:07 2024]
Finished job 1.
1 of 17 steps (6%) done
[Mon Jul  1 12:51:08 2024]
Finished job 11.
2 of 17 steps (12%) done
Select jobs to execute...

[Mon Jul  1 12:51:08 2024]
rule split_reads:
    input: MrHAMER2_test/align/1d.bam
    output: MrHAMER2_test/fasta_filtered, MrHAMER2_test/stats/umi_filter_reads_stats.txt
    jobid: 10
    reason: Missing output files: MrHAMER2_test/fasta_filtered; Input files updated by another job: MrHAMER2_test/align/1d.bam
    wildcards: name=MrHAMER2_test
    resources: tmpdir=/tmp

[Mon Jul  1 12:51:09 2024]
Finished job 10.
3 of 17 steps (18%) done
Select jobs to execute...

[Mon Jul  1 12:51:09 2024]
rule detect_umi_fasta:
    input: MrHAMER2_test/fasta_filtered
    output: MrHAMER2_test/fasta_umi/Env_detected_umis.fasta
    jobid: 9
    reason: Missing output files: MrHAMER2_test/fasta_umi/Env_detected_umis.fasta; Input files updated by another job: MrHAMER2_test/fasta_filtered
    wildcards: name=MrHAMER2_test, target=Env
    resources: tmpdir=/tmp

[Mon Jul  1 12:51:10 2024]
Finished job 9.
4 of 17 steps (24%) done
Select jobs to execute...

[Mon Jul  1 12:51:10 2024]
rule cluster:
    input: MrHAMER2_test/fasta_umi/Env_detected_umis.fasta
    output: MrHAMER2_test/clustering/Env/clusters_centroid.fasta, MrHAMER2_test/clustering/Env/clusters_consensus.fasta, MrHAMER2_test/clustering/Env/vsearch_clusters
    jobid: 8
    reason: Missing output files: MrHAMER2_test/clustering/Env/clusters_consensus.fasta, MrHAMER2_test/clustering/Env/vsearch_clusters; Input files updated by another job: MrHAMER2_test/fasta_umi/Env_detected_umis.fasta
    wildcards: name=MrHAMER2_test, target=Env
    threads: 10
    resources: tmpdir=/tmp

[Mon Jul  1 12:51:10 2024]
Finished job 8.
5 of 17 steps (29%) done
Select jobs to execute...

[Mon Jul  1 12:51:10 2024]
rule reformat_filter_clusters:
    input: MrHAMER2_test/clustering/Env/clusters_consensus.fasta, MrHAMER2_test/clustering/Env/vsearch_clusters
    output: MrHAMER2_test/clustering/Env/clusters_fa, MrHAMER2_test/stats/Env_vsearch_cluster_stats.tsv, MrHAMER2_test/clustering/Env/smolecule_clusters.fa
    jobid: 7
    reason: Missing output files: MrHAMER2_test/clustering/Env/smolecule_clusters.fa, MrHAMER2_test/stats/Env_vsearch_cluster_stats.tsv, MrHAMER2_test/clustering/Env/clusters_fa; Input files updated by another job: MrHAMER2_test/clustering/Env/clusters_consensus.fasta, MrHAMER2_test/clustering/Env/vsearch_clusters
    wildcards: name=MrHAMER2_test, target=Env
    resources: tmpdir=/tmp

[Mon Jul  1 12:51:10 2024]
Finished job 7.
6 of 17 steps (35%) done
Select jobs to execute...

[Mon Jul  1 12:51:10 2024]
rule polish_clusters:
    input: MrHAMER2_test/clustering/Env/clusters_fa, MrHAMER2_test/clustering/Env/smolecule_clusters.fa
    output: MrHAMER2_test/fasta/Env_consensus_tmp, MrHAMER2_test/fasta/Env_consensus.bam, MrHAMER2_test/fasta/Env_consensus.fasta
    jobid: 6
    reason: Missing output files: MrHAMER2_test/fasta/Env_consensus.fasta; Input files updated by another job: MrHAMER2_test/clustering/Env/smolecule_clusters.fa, MrHAMER2_test/clustering/Env/clusters_fa
    wildcards: name=MrHAMER2_test, target=Env
    threads: 30
    resources: tmpdir=/tmp

[Mon Jul  1 12:51:10 2024]
Error in rule polish_clusters:
    jobid: 6
    input: MrHAMER2_test/clustering/Env/clusters_fa, MrHAMER2_test/clustering/Env/smolecule_clusters.fa
    output: MrHAMER2_test/fasta/Env_consensus_tmp, MrHAMER2_test/fasta/Env_consensus.bam, MrHAMER2_test/fasta/Env_consensus.fasta
    shell:
        
        rm -rf MrHAMER2_test/fasta/Env_consensus_tmp
        medaka smolecule --threads 30 --length 50 --min_depth 2 --model /test_files/r1041_e82_400bps_sup_v4.2.0_model.tar.gz --method racon --qualities MrHAMER2_test/fasta/Env_consensus_tmp MrHAMER2_test/clustering/Env/smolecule_clusters.fa 2> MrHAMER2_test/fasta/Env_consensus.bam_smolecule.log
        cp MrHAMER2_test/fasta/Env_consensus_tmp/consensus.fastq MrHAMER2_test/fasta/Env_consensus.fasta
        cp MrHAMER2_test/fasta/Env_consensus_tmp/subreads_to_spoa.bam MrHAMER2_test/fasta/Env_consensus.bam && cp MrHAMER2_test/fasta/Env_consensus_tmp/subreads_to_spoa.bam.bai MrHAMER2_test/fasta/Env_consensus.bam.bai
        
        (one of the commands exited with non-zero exit code; note that snakemake uses bash strict mode!)

Shutting down, this might take some time.
Exiting because a job execution failed. Look above for error message
Complete log: .snakemake/log/2024-07-01T125107.281799.snakemake.log
